============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.1, pluggy-1.6.0
rootdir: C:\Users\pault\Documents\3. AI and Machine Learning\2. Deep Learning\1c. App\Projects\agents-backend
configfile: pyproject.toml
plugins: anyio-4.12.0, Faker-25.0.0, langsmith-0.4.23, libtmux-0.53.0, asyncio-1.3.0, cov-7.0.0, django-4.5.2, mock-3.11.1, postgresql-7.0.2, sugar-1.1.1, xdist-3.3.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 3 items

backend\tests\unit\test_agent_basics_custom.py .F.                       [100%]

================================== FAILURES ===================================
______________________ test_create_agent_with_middleware ______________________

mock_dependencies = {'create_agent': <MagicMock name='langchain_create_agent' id='1864790265872'>, 'get_llm': <MagicMock name='get_llm' id... <MagicMock name='get_prompt_template' id='1864790265536'>, 'settings': <MagicMock name='settings' id='1864790266208'>}

    def test_create_agent_with_middleware(mock_dependencies):
        """Test creating an agent with default middleware configuration."""
    
        # Configure specific middleware via config dict
        mw_config = {
            "enable_model_retry": True,
            "model_max_retries": 5,
            "enable_tool_retry": True
        }
    
>       agent = create_agent(
            agent_name="TestAgent_WithMW",
            agent_type="tester",
            tools=[add_tool, multiply_tool],
            prompt_template="test_template",
            use_default_middleware=True,
            middleware_config=mw_config
        )

backend\tests\unit\test_agent_basics_custom.py:105: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
backend\src\agents\agents.py:335: in create_agent
    default_mw = build_default_middleware(**config)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend\src\agents\agents.py:168: in build_default_middleware
    ModelRetryMiddleware(
C:\Users\pault\AppData\Roaming\Python\Python313\site-packages\langchain\agents\middleware\model_retry.py:155: in __init__
    validate_retry_params(max_retries, initial_delay, max_delay, backoff_factor)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

max_retries = 5
initial_delay = <MagicMock name='settings.MIDDLEWARE_MODEL_INITIAL_DELAY' id='1864790267888'>
max_delay = 60.0
backoff_factor = <MagicMock name='settings.MIDDLEWARE_MODEL_BACKOFF_FACTOR' id='1864790267552'>

    def validate_retry_params(
        max_retries: int,
        initial_delay: float,
        max_delay: float,
        backoff_factor: float,
    ) -> None:
        """Validate retry parameters.
    
        Args:
            max_retries: Maximum number of retry attempts.
            initial_delay: Initial delay in seconds before first retry.
            max_delay: Maximum delay in seconds between retries.
            backoff_factor: Multiplier for exponential backoff.
    
        Raises:
            ValueError: If any parameter is invalid (negative values).
        """
        if max_retries < 0:
            msg = "max_retries must be >= 0"
            raise ValueError(msg)
>       if initial_delay < 0:
           ^^^^^^^^^^^^^^^^^
E       TypeError: '<' not supported between instances of 'MagicMock' and 'int'

C:\Users\pault\AppData\Roaming\Python\Python313\site-packages\langchain\agents\middleware\_retry.py:55: TypeError
=========================== short test summary info ===========================
FAILED backend/tests/unit/test_agent_basics_custom.py::test_create_agent_with_middleware
======================== 1 failed, 2 passed in 11.56s =========================
